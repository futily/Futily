{% extends "squads/_builder_edit_base.html" %}

{% block strapline_title %}Update squad{% endblock %}
{% block strapline_text %}
  {{ object.title }}{% if object.user %} by
    <a href="{{ object.user.get_absolute_url() }}">{{ object.user }}</a>{% endif %}
{% endblock %}

{% block builder_data %}data-initial="{{ initial_data }}"{% endblock %}
{% block builder_editable %}true{% endblock %}
{% block builder_title %}{{ object.title }}{% endblock %}
{% block builder_class %}bld-Builder-{{ squad.formation }}{% endblock %}
{% block builder_formation %}{{ squad.formation }}{% endblock %}
{% block builder_action %}{{ request.path }}{% endblock %}

{% block builder_players %}
  {% for player in squad.get_players()['team'] %}
    <li class="bld-Builder_PlayersItem bld-Builder_PlayersItem-{{ FORMATION_POSITIONS.verbose[loop.index0] | lower() }}"
        aria-grabbed="false"
        data-builder-formation-index="{{ loop.index0 }}"
        data-builder-filled="{{ 'true' if player else 'false' }}">
      <div class="bld-Slot"
        {% if player %}
           data-builder-initial-data="{{ player.player.get_serializer_data() }}"
        {% endif %}>
        {% if player %}
          {{ player.player.render_card(chemistry=0, has_link=False) }}
        {% endif %}
      </div>
      <span class="bld-Slot_Pedestal">{{ player.position if player else FORMATION_POSITIONS.positions[loop.index0] }}</span>
      <input type="hidden" name="players" class="bld-Builder_PlayerInput">
      <div class="bld-Slot_Controls">
        <div class="bld-Slot_Control bld-Builder_Control-remove">
          <span class="bld-Builder_ControlIcon">
            {% include 'trash.svg' %}
          </span>

          <span class="bld-Builder_ControlText">Remove</span>
        </div>

        <div class="bld-Slot_Control bld-Builder_Control-changePosition">
          <span class="bld-Builder_ControlIcon">
            {% include 'shuffle.svg' %}
          </span>

          <span class="bld-Builder_ControlText">Change position</span>
        </div>

        <div class="bld-Slot_Control bld-Builder_Control-toggleLoyalty">
          <span class="bld-Builder_ControlIcon">
            {% include 'heart.svg' %}
          </span>

          <span class="bld-Builder_ControlText">Toggle loyalty</span>
        </div>
      </div>
    </li>
  {% endfor %}
{% endblock %}

{% block builder_footer %}
  <div class="bld-Builder_Columns">
    <div class="bld-Builder_Column">
      <div class="frm-Form_Items">
        <div class="frm-Form_Item frm-Form_Item-full frm-Form_Item-floatingLabel js-FloatingLabel js-FloatingLabel-active">
          <label class="frm-Form_Label js-FloatingLabel_Label" for="name">
            Formation:
          </label>

          <select class="frm-Form_Select js-FloatingLabel_Input"
                  id="formation"
                  name="formation">
            <option value="">Formations</option>
            {% for value, label in formations.items() %}
              <option value="{{ value }}"{% if squad.formation == value %}
                      selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="frm-Form_Item frm-Form_Item-full frm-Form_Item-floatingLabel js-FloatingLabel">
          <label class="frm-Form_Label js-FloatingLabel_Label" for="title">
            Squad Name:
          </label>

          <input type="text"
                 class="frm-Form_Input js-FloatingLabel_Input"
                 placeholder="Name"
                 name="title"
                 value="{{ squad.title }}"
                 id="title" />
        </div>
      </div>
    </div>

    <div class="bld-Builder_Column">
      <div class="bld-Builder_Stats">
        <div class="bld-Stats">
          <ul class="bld-Stats_Items">
            <li class="bld-Stats_Item" data-builder-stat-name="rating">
              <input type="hidden" name="rating" value="{{ squad.rating }}">
              <span class="bld-Stats_Label">Rating:</span>
              <span class="bld-Stats_Value">{{ squad.rating }}</span>
            </li>

            <li class="bld-Stats_Item" data-builder-stat-name="chemistry">
              <input type="hidden" name="chemistry" value="{{ squad.chemistry }}">
              <span class="bld-Stats_Label">Chemistry:</span>
              <span class="bld-Stats_Value">{{ squad.chemistry }}</span>
            </li>
          </ul>
        </div>
      </div>

      <div class="bld-Builder_Import">
        <input type="hidden" name="page" value="{{ pages.current.id }}" />
        <input type="hidden" name="user" value="{{ user.id }}" />

        <button class="btn-Primary" type="submit">
          Save
        </button>
      </div>
    </div>

    <div class="bld-Builder_Column">
      <div class="bld-Builder_Stats">
        <div class="bld-Stats">
          <ul class="bld-Stats_Items">
            <li class="bld-Stats_Item" data-builder-stat-name="attack">
              <input type="hidden" name="attack" value="{{ squad.attack }}">
              <span class="bld-Stats_Label">Attack</span>
              <span class="bld-Stats_Value" data-builder-stat-value>{{ squad.attack }}</span>
            </li>

            <li class="bld-Stats_Item" data-builder-stat-name="midfield">
              <input type="hidden" name="midfield" value="{{ squad.midfield }}">
              <span class="bld-Stats_Label">Midfield</span>
              <span class="bld-Stats_Value" data-builder-stat-value>{{ squad.midfield }}</span>
            </li>

            <li class="bld-Stats_Item" data-builder-stat-name="defence">
              <input type="hidden" name="defence" value="{{ squad.defence }}">
              <span class="bld-Stats_Label">Defence</span>
              <span class="bld-Stats_Value" data-builder-stat-value>{{ squad.defence }}</span>
            </li>

            <li class="bld-Stats_Item" data-builder-stat-name="pace">
              <input type="hidden" name="pace" value="{{ squad.pace }}">
              <span class="bld-Stats_Label">Pace</span>
              <span class="bld-Stats_Value" data-builder-stat-value>{{ squad.pace }}</span>
            </li>

            <li class="bld-Stats_Item" data-builder-stat-name="shooting">
              <input type="hidden" name="shooting" value="{{ squad.shooting }}">
              <span class="bld-Stats_Label">Shooting</span>
              <span class="bld-Stats_Value" data-builder-stat-value>{{ squad.shooting }}</span>
            </li>

            <li class="bld-Stats_Item" data-builder-stat-name="passing">
              <input type="hidden" name="passing" value="{{ squad.passing }}">
              <span class="bld-Stats_Label">Passing</span>
              <span class="bld-Stats_Value" data-builder-stat-value>{{ squad.passing }}</span>
            </li>

            <li class="bld-Stats_Item" data-builder-stat-name="dribbling">
              <input type="hidden" name="dribbling" value="{{ squad.dribbling }}">
              <span class="bld-Stats_Label">Dribbling</span>
              <span class="bld-Stats_Value" data-builder-stat-value>{{ squad.dribbling }}</span>
            </li>

            <li class="bld-Stats_Item" data-builder-stat-name="defending">
              <input type="hidden" name="defending" value="{{ squad.defending }}">
              <span class="bld-Stats_Label">Defending</span>
              <span class="bld-Stats_Value" data-builder-stat-value>{{ squad.defending }}</span>
            </li>

            <li class="bld-Stats_Item" data-builder-stat-name="physical">
              <input type="hidden" name="physical" value="{{ squad.physical }}">
              <span class="bld-Stats_Label">Physical</span>
              <span class="bld-Stats_Value" data-builder-stat-value>{{ squad.physical }}</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
